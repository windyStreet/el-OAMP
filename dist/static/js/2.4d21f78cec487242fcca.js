webpackJsonp([2],{InQx:function(e,t){},"U+hv":function(e,t){},YdTO:function(e,t){},sEiL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={name:"serviceCheckList",data(){return{module_name:"serviceCheck",refresh_page_method:"refresh_"+this.module_name,project_type_code_list:null,project_env_code_list:null,project_state_code_list:null,service_state_code_list:null,project_team_code_list:null,searchFormData:{pageNum:1,pageSize:16,pageCount:1,project:"",project_name:"",createTime:"",order:"+project"},tableData:[]}},created(){this.$store.state.Apps.$on(this.refresh_page_method,()=>{this.search()})},async mounted(){this.project_type_code_list=await this.$setCodeList(this.project_type_code_list,"project_type"),this.project_env_code_list=await this.$setCodeList(this.project_env_code_list,"project_env"),this.project_state_code_list=await this.$setCodeList(this.project_state_code_list,"project_state"),this.project_service_state_code_list=await this.$setCodeList(this.project_service_state_code_list,"project_service_state");let e=await this.$exec({},"OAMP_search_project_team_code_list");null!=e&&null!=e.data&&(this.project_team_code_list=e.data),this.search()},methods:{handleSizeChange(e){this.searchFormData.pageSize=e,this.search()},handleCurrentChange(e){this.searchFormData.pageNum=e,this.search()},onReset(){this.$refs.searchFormRef.resetFields(),this.search()},format_project_type(e,t,a){return this.$formatCodeValue(e,this.project_type_code_list,"project_type_code_id")},format_project_env(e,t,a){return this.$formatCodeValue(e,this.project_env_code_list,"project_env_code_id")},format_project_state(e,t,a){return this.$formatCodeValue(e,this.project_state_code_list,"project_state_code_id")},format_project_service_state_style(e,t){let a=e[t];return"1"===a?"set-info":"-1"===a?"set-warning":"0"===a?"set-danger":"set-black"},format_project_service_state(e,t,a){return this.$formatCodeValue(e,this.project_service_state_code_list,"project_service_state_code_id")},format_project_team(e,t,a){return this.$formatCodeValue(e,this.project_team_code_list,t.property,"_id","project_team_name")},async r_deleteProjectInfo(e){let t=new this.$http,{data:a}=await t.post(e,"OAMP_delete_ProjectInfo");return null!=a&&"null"!==a},onSearch(){this.searchFormData.pageNum=1,this.search()},async search(){let e=this.searchFormData,t=await this.$search(e,"OAMP_search_project_list");this.searchFormData.pageCount=t.pageCount,this.tableData=t.data},onDelete(e,t){let a=t[e];this.r_deleteProjectInfo(a)?(t.splice(e,1),this.$message.success("删除数据成功"),this.search()):this.$message.error("删除数据失败")},on_project_configure(e,t){this.$router.push({name:"projectConf",params:{projectId:t[e]._id}})},async on_recreate_service_check(){let e=await this.$exec({},"OAMP_recreate_service_check");null!=e&&"1"===e.success?this.$message.success("重新生成检查服务成功"):this.$message.warning("重新生成检查服务异常")},async on_run_project_service_check_task(e,t){let a={service_project_id:t[e]._id},s=await this.$exec(a,"OAMP_run_service_check_task");null!=s&&"1"===s.success?this.$message.success("运行项目服务检查成功"):this.$message.warning("运行项目服务检查异常"),this.search()}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"padding-top":"2px"}},[a("el-form",{ref:"searchFormRef",attrs:{inline:!0,model:e.searchFormData,size:"mini"}},[a("el-form-item",{attrs:{label:"项目",prop:"project"}},[a("el-input",{attrs:{placeholder:"请输入项目"},model:{value:e.searchFormData.project,callback:function(t){e.$set(e.searchFormData,"project",t)},expression:"searchFormData.project"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目名称",prop:"project_name"}},[a("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.searchFormData.project_name,callback:function(t){e.$set(e.searchFormData,"project_name",t)},expression:"searchFormData.project_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间",prop:"createTime"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchFormData.createTime,callback:function(t){e.$set(e.searchFormData,"createTime",t)},expression:"searchFormData.createTime"}})],1),e._v(" "),a("div",{staticClass:"v-search-opt"},[a("div",{staticClass:"v-pagination"},[a("el-pagination",{attrs:{"current-page":e.searchFormData.pageNum,"page-size":e.searchFormData.pageSize,total:e.searchFormData.pageCount,"page-sizes":[16,30,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{staticClass:"v-inline"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onSearch}},[a("i",{staticClass:"iconfont icon-chaxun"}),e._v(" 查询")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onReset}},[a("i",{staticClass:"iconfont icon-chongzhi"}),e._v(" 重置")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.on_recreate_service_check}},[a("i",{staticClass:"iconfont icon-chongxinshengcheng"}),e._v(" 重新生成检查服务")])],1)])],1),e._v(" "),a("hr"),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:!0,stripe:!0,size:"mini",height:e.getTableHeight(130)}},[a("el-table-column",{attrs:{fixed:"left",type:"index",index:e.onIndexMethod(e.searchFormData.pageNum,e.searchFormData.pageSize),label:"序号",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-col",{attrs:{span:10}},[a("el-button",{attrs:{type:"primary",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.on_run_project_service_check_task(t.$index,e.tableData)}}},[e._v("运行检测")])],1),e._v(" "),a("el-col",{attrs:{offset:2,span:10}},[a("el-button",{attrs:{type:"primary",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.onView(e.module_name,t.$index,e.tableData)}}},[e._v("运行详情")])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",prop:"project_service_state_code_id",label:"项目服务运行状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",[a("i",{class:"iconfont icon-dian "+e.format_project_service_state_style(t.row,"project_service_state_code_id")}),e._v(e._s("    "+e.format_project_service_state(t.row)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",prop:"project_container_status",label:"项目服务运行情况",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",formatter:e.format_project_state,prop:"project_state_code_id",label:"项目运行状态",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"project",label:"项目",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"project_name",label:"项目名称",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"project_context",label:"项目上下文",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"156"}}),e._v(" "),a("el-table-column",{attrs:{formatter:e.format_project_type,prop:"project_type_code_id",label:"项目类型",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{formatter:e.format_project_env,prop:"project_env_code_id",label:"项目环境",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{prop:"project_version",label:"项目版本",width:"110"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,formatter:e.format_project_team,prop:"project_team_id",label:"项目团队"}})],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,r,!1,function(e){a("InQx")},"data-v-77800f82",null).exports,i={name:"serviceCheckInfo",data(){return{module_name:"serviceCheck",refresh_page_method:"refresh_"+this.module_name,service_state_code_list:null,service_check_state_code_list:null,pageData:{},tableData:[],searchFormData:{pageNum:1,pageSize:12,pageCount:0}}},computed:{pageInfo(){return this.$setPageInfo(this.module_name)}},watch:{pageData(){this.search()}},async mounted(){this.service_state_code_list=await this.$setCodeList(this.service_state_code_list,"service_state"),this.service_check_state_code_list=await this.$setCodeList(this.service_check_state_code_list,"service_check_state")},methods:{handleSizeChange(e){this.searchFormData.pageSize=e,this.search()},handleCurrentChange(e){this.searchFormData.pageNum=e,this.search()},onSearch(){this.searchFormData.pageNum=1,this.search()},async search(){let e=this.searchFormData;null!=this.pageInfo.pageData&&this.pageInfo.pageData.hasOwnProperty("_id")&&(e.service_project_id=this.pageInfo.pageData._id);let t=await this.$search(e,"OAMP_search_service_check_list");this.searchFormData.pageCount=t.pageCount,this.tableData=t.data},format_service_state(e,t,a){return this.$formatCodeValue(e,this.service_state_code_list,"service_state_code_id")},format_service_state_style(e,t){let a=e[t];return"1"===a?"set-info":"2"===a?"set-warning":"0"===a?"set-danger":"set-black"},format_service_check_state(e,t,a){return this.$formatCodeValue(e,this.service_check_state_code_list,"service_check_state_code_id")},format_service_check_state_style(e,t){let a=e[t];return"1"===a?"set-info":"3"===a||"2"===a?"set-warning":"0"===a?"set-danger":"set-black"},format_service_ips(e,t,a){let s="";for(let t=0;e.service_ips&&t<e.service_ips.length;t++)s+="["+e.service_ips[t]+"]";return s},async on_run_all_service_check_task(){let e={service_project_id:this.pageInfo.pageData._id},t=await this.$exec(e,"OAMP_run_service_check_task");null!=t&&"1"===t.success?this.$message.success("运行全部检查成功"):this.$message.warning("运行全部检查异常"),this.search()},async on_recreate_service_check_task(){let e={service_project_id:this.pageInfo.pageData._id},t=await this.$exec(e,"OAMP_recreate_service_check");null!=t&&"1"===t.success?this.$message.success("重新生成检查服务成功"):this.$message.warning("重新生成检查服务异常")},async on_run_service_check_task(e,t){let a=t[e],s={service_project_id:this.pageInfo.pageData._id,_id:a._id},r=await this.$exec(s,"OAMP_run_service_check_task");null!=r&&"1"===r.success?this.$message.success("运行检查成功"):this.$message.warning("运行检查异常"),this.search()},async on_pause_service_check_task(e,t){let a=t[e],s=await this.$exec(a,"OAMP_pause_service_check");null!=s&&"1"===s.success?this.$message.success("暂停服务检查成功"):this.$message.warning("暂停服务检查异常"),this.search()},async on_resume_service_check_task(e,t){let a=t[e],s=await this.$exec(a,"OAMP_resume_service_check");null!=s&&"1"===s.success?this.$message.success("恢复服务检查成功"):this.$message.warning("恢复服务检查异常"),this.search()},async handleEdit(e,t){let a=await this.$exec(t,"OAMP_modify_service_check_info");null!=a&&"1"===a.success?this.$message.success("修改服务检查成功"):this.$message.warning("修改服务检查异常"),this.search()}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{slot:"title",title:"【"+e.pageData.project_name+"】项目服务检查运行详情",width:"1460px",visible:e.pageInfo.isShow,"modal-append-to-body":!1,"close-on-click-modal":!1,center:!0,"lock-scroll":!1},on:{close:function(t){return e.onClose(e.module_name)}},slot:"title"},[a("el-form",{ref:"searchFormRef",attrs:{inline:!0,model:e.searchFormData,size:"mini"}},[a("div",{staticClass:"v-center"},[a("div",{staticClass:"v-inline"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onSearch}},[a("i",{staticClass:"iconfont icon-chaxun"}),e._v(" 查询")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.on_run_all_service_check_task}},[a("i",{staticClass:"iconfont icon-jiance"}),e._v(" 检测全部")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.on_recreate_service_check_task}},[a("i",{staticClass:"iconfont icon-chongxinshengcheng"}),e._v(" 重新生成检查规则")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.onClose(e.module_name)}}},[a("i",{staticClass:"iconfont icon-guanbi"}),e._v(" 关闭")])],1)])]),e._v(" "),a("hr"),e._v(" "),a("el-table",{staticClass:"tb-edit",attrs:{data:e.tableData,border:!0,stripe:!0,size:"mini",height:e.getTableHeight(330),"highlight-current-row":""}},[a("el-table-column",{attrs:{fixed:"left",type:"index",index:e.onIndexMethod(e.searchFormData.pageNum,e.searchFormData.pageSize),label:"序号",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"success",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.on_run_service_check_task(t.$index,e.tableData)}}},[e._v("运行")])],1),e._v(" "),"1"===t.row.service_check_state_code_id?a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"info",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.on_pause_service_check_task(t.$index,e.tableData)}}},[e._v("暂停")])],1):"2"===t.row.service_check_state_code_id?a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"warning",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.on_resume_service_check_task(t.$index,e.tableData)}}},[e._v("恢复")])],1):a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"danger",size:"mini"}},[e._v("错误")])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"left",formatter:e.format_service_state,prop:"service_state_code_id",label:"服务运行状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",[a("i",{class:"iconfont icon-dian "+e.format_service_state_style(t.row,"service_state_code_id")}),e._v(e._s("    "+e.format_service_state(t.row)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{formatter:e.format_service_check_state,prop:"service_check_state_code_id",label:"服务检查状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",[a("i",{class:"iconfont icon-dian "+e.format_service_check_state_style(t.row,"service_check_state_code_id")}),e._v(e._s("    "+e.format_service_check_state(t.row)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"service_check_count",label:"检查累计",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"service_check_error_count",label:"错误累计",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"service_check_continued_error_count",label:"连续错误数",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"service_check_last_result",label:"最新检查结果",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"最新检测时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{label:"检查频率",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:"请输入内容"},on:{change:function(a){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.service_check_rate,callback:function(a){e.$set(t.row,"service_check_rate",a)},expression:"scope.row.service_check_rate"}}),e._v(" "),a("span",[e._v(e._s(t.row.service_check_rate))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,formatter:e.format_service_ips,prop:"service_ips",label:"服务ip",width:"220"}}),e._v(" "),a("el-table-column",{attrs:{prop:"service_port",label:"服务端口"}})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.searchFormData.pageNum,"page-size":e.searchFormData.pageSize,total:e.searchFormData.pageCount,"page-sizes":[12,20,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},staticRenderFns:[]};var n={name:"serviceCheck",components:{list:c,info:a("VU/8")(i,o,!1,function(e){a("U+hv")},"data-v-c8d00bec",null).exports},data:()=>({})},_={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"v-container"},[t("el-breadcrumb",[t("el-breadcrumb-item",{attrs:{to:{path:"/tool"}}},[this._v("工具")]),this._v(" "),t("el-breadcrumb-item",[this._v("服务检查列表")])],1),this._v(" "),t("hr"),this._v(" "),t("list"),this._v(" "),t("info")],1)},staticRenderFns:[]};var l=a("VU/8")(n,_,!1,function(e){a("YdTO")},null,null);t.default=l.exports}});
//# sourceMappingURL=2.4d21f78cec487242fcca.js.map